<div class="page-container">
  <div class="card">
    <div class="card-header">
      <h3>ğŸ“Š Báº£ng Ä‘iá»ƒm cá»§a tÃ´i</h3>
      <div class="header-actions">
        <button class="btn btn-export" (click)="exportGrades()" *ngIf="grades && grades.gradeItems.length > 0">
          ğŸ“„ Xuáº¥t báº£ng Ä‘iá»ƒm
        </button>
        <button class="btn-logout" (click)="logout()">ğŸšª Logout</button>
      </div>
    </div>

    <div class="card-body">
      <div *ngIf="error" class="error-message">âš ï¸ {{ error }}</div>
      <div *ngIf="loading" class="loading-message">â³ Äang táº£i báº£ng Ä‘iá»ƒm...</div>
      
      <!-- Student Grade Summary -->
      <div *ngIf="grades && !loading" class="grade-summary">
        <div class="summary-card gpa-card">
          <div class="summary-icon">ğŸ¯</div>
          <div class="summary-content">
            <div class="summary-label">Äiá»ƒm trung bÃ¬nh tÃ­ch lÅ©y (GPA)</div>
            <div class="summary-value gpa-value" [class.excellent]="grades.gpa >= 3.6" 
                 [class.good]="grades.gpa >= 3.0 && grades.gpa < 3.6"
                 [class.average]="grades.gpa >= 2.0 && grades.gpa < 3.0"
                 [class.poor]="grades.gpa < 2.0">
              {{ grades.gpa | number:'1.2-2' }}/4.0
            </div>
            <div class="gpa-classification">{{ getGPAClassification(grades.gpa) }}</div>
          </div>
        </div>

        <div class="summary-card credits-card">
          <div class="summary-icon">ğŸ“š</div>
          <div class="summary-content">
            <div class="summary-label">TÃ­n chá»‰ tÃ­ch lÅ©y</div>
            <div class="summary-value">{{ grades.completedCredits }}/{{ grades.totalCredits }}</div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getCompletionPercentage()"></div>
            </div>
          </div>
        </div>

        <div class="summary-card student-card">
          <div class="summary-icon">ğŸ‘¨â€ğŸ“</div>
          <div class="summary-content">
            <div class="summary-label">Sinh viÃªn</div>
            <div class="summary-value student-name">{{ grades.studentName }}</div>
            <div class="student-code">{{ grades.studentCode }}</div>
          </div>
        </div>
      </div>

      <div *ngIf="!loading && (!grades || grades.gradeItems.length === 0)" class="no-data">
        <div class="no-data-icon">ğŸ“</div>
        <div class="no-data-text">ChÆ°a cÃ³ Ä‘iá»ƒm sá»‘ nÃ o Ä‘Æ°á»£c ghi nháº­n</div>
        <button class="btn btn-primary" (click)="goToSchedule()">
          ğŸ“… Xem thá»i khÃ³a biá»ƒu
        </button>
      </div>

      <!-- Filter and Search -->
      <div *ngIf="grades && grades.gradeItems.length > 0" class="filter-section">
        <div class="filter-row">
          <div class="search-box">
            <input type="text" class="search-input" placeholder="ğŸ” TÃ¬m kiáº¿m mÃ´n há»c..." 
                   [(ngModel)]="searchTerm" (input)="filterGrades()">
          </div>
          <div class="filter-controls">
            <select class="filter-select" [(ngModel)]="statusFilter" (change)="filterGrades()">
              <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
              <option value="ÄÃ£ hoÃ n thÃ nh">ÄÃ£ hoÃ n thÃ nh</option>
              <option value="Äang há»c">Äang há»c</option>
              <option value="ChÆ°a há»c">ChÆ°a há»c</option>
            </select>
            <select class="filter-select" [(ngModel)]="semesterFilter" (change)="filterGrades()">
              <option value="">Táº¥t cáº£ há»c ká»³</option>
              <option *ngFor="let semester of availableSemesters" [value]="semester.semester">
                {{ semester.displayName }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Grades Table -->
      <div *ngIf="filteredGrades && filteredGrades.length > 0" class="grades-table-container">
        <table class="grades-table">
          <thead>
            <tr>
              <th>MÃ£ mÃ´n</th>
              <th>TÃªn mÃ´n há»c</th>
              <th>TÃ­n chá»‰</th>
              <th>Äiá»ƒm TP1</th>
              <th>Äiá»ƒm TP2</th>
              <th>Äiá»ƒm CK</th>
              <th>Äiá»ƒm chá»¯</th>
              <th>Tráº¡ng thÃ¡i</th>
              <th>Há»c ká»³</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filteredGrades" class="grade-row" 
                [class.completed]="item.status === 'ÄÃ£ hoÃ n thÃ nh'"
                [class.in-progress]="item.status === 'Äang há»c'"
                [class.not-started]="item.status === 'ChÆ°a há»c'">
              <td class="course-code">{{ item.courseCode }}</td>
              <td class="course-name">{{ item.courseName }}</td>
              <td class="credit">
                <span class="credit-badge">{{ item.credit }}</span>
              </td>
              <td class="score" [class.has-score]="item.componentScore1 !== null">
                {{ item.componentScore1 !== null ? (item.componentScore1 | number:'1.1-1') : '-' }}
              </td>
              <td class="score" [class.has-score]="item.componentScore2 !== null">
                {{ item.componentScore2 !== null ? (item.componentScore2 | number:'1.1-1') : '-' }}
              </td>
              <td class="score" [class.has-score]="item.finalExamScore !== null">
                {{ item.finalExamScore !== null ? (item.finalExamScore | number:'1.1-1') : '-' }}
              </td>
              <td class="grade" [class]="getGradeClass(item.grade)">
                <span class="grade-badge" *ngIf="item.grade">{{ item.grade }}</span>
                <span class="no-grade" *ngIf="!item.grade">ChÆ°a cÃ³</span>
              </td>
              <td class="status">
                <span class="status-badge" [class]="getStatusClass(item.status)">
                  {{ item.status }}
                </span>
              </td>
              <td class="semester">{{ item.semester || 'N/A' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Statistics -->
      <div *ngIf="grades && grades.gradeItems.length > 0" class="statistics-section">
        <h4>ğŸ“ˆ Thá»‘ng kÃª chi tiáº¿t</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Tá»•ng sá»‘ mÃ´n</div>
            <div class="stat-value">{{ grades.gradeItems.length }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">ÄÃ£ hoÃ n thÃ nh</div>
            <div class="stat-value completed">{{ getCompletedCount() }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Äang há»c</div>
            <div class="stat-value in-progress">{{ getInProgressCount() }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Äiá»ƒm A</div>
            <div class="stat-value grade-a">{{ getGradeCount('A') }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Äiá»ƒm B+</div>
            <div class="stat-value grade-b-plus">{{ getGradeCount('B+') }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Äiá»ƒm B</div>
            <div class="stat-value grade-b">{{ getGradeCount('B') }}</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
