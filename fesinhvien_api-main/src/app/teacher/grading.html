<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex justify-between items-center">
    <div>
      <h2 class="text-3xl font-bold text-gray-900">📝 Chấm điểm sinh viên</h2>
      <p class="text-gray-600 mt-1">Quản lý và chấm điểm cho sinh viên</p>
    </div>
    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" [(ngModel)]="selectedSemester" (change)="onSemesterChange()">
      <option *ngFor="let semester of availableSemesters" [value]="semester.semester">
        {{ semester.displayName }}
      </option>
    </select>
  </div>

  <!-- Loading & Error States -->
  <div *ngIf="loading" class="text-center py-12">
    <p class="text-gray-500 text-lg">⏳ Đang tải dữ liệu...</p>
  </div>

  <div *ngIf="error" class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg">
    <p class="text-red-700">⚠️ {{ error }}</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && classes.length === 0" class="text-center py-12 bg-white rounded-xl border border-gray-200">
    <div class="text-6xl mb-4">📭</div>
    <p class="text-gray-600 text-lg">Chưa có lớp học nào được phân công</p>
  </div>

  <!-- Class Selection -->
  <div *ngIf="!loading && classes.length > 0" class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
    <h4 class="text-xl font-bold text-gray-900 mb-4">🎯 Chọn lớp học</h4>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div *ngFor="let classInfo of classes" 
           (click)="selectClass(classInfo)"
           class="border-2 rounded-lg p-4 cursor-pointer transition-all hover:shadow-md"
           [class.border-green-500]="selectedClass?.teachingId === classInfo.teachingId"
           [class.bg-green-50]="selectedClass?.teachingId === classInfo.teachingId"
           [class.border-gray-200]="selectedClass?.teachingId !== classInfo.teachingId">
        <div class="font-bold text-gray-900 mb-2">{{ classInfo.courseCode }}</div>
        <div class="text-sm text-gray-600 mb-3">{{ classInfo.courseName }}</div>
        <div class="flex items-center justify-between text-sm mb-2">
          <span class="text-gray-600">🎯 {{ classInfo.credit }} tín chỉ</span>
          <span class="text-gray-600">📊 {{ getGradedCount(classInfo.students) }}/{{ getTotalCount(classInfo.students) }}</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div class="bg-green-500 h-2 rounded-full transition-all" [style.width.%]="getProgressPercentage(classInfo.students)"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Grading Interface -->
  <div *ngIf="selectedClass" class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
    <div class="flex justify-between items-center mb-4">
      <div>
        <h4 class="text-xl font-bold text-gray-900">📝 Chấm điểm - {{ selectedClass.courseCode }}</h4>
        <p class="text-gray-600">{{ getGradedCount(selectedClass.students) }}/{{ getTotalCount(selectedClass.students) }} sinh viên đã chấm ({{ getProgressPercentage(selectedClass.students) }}%)</p>
      </div>
      <div class="flex space-x-3">
        <button (click)="saveAllScores()" [disabled]="saving" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50">
          💾 Lưu tất cả
        </button>
        <button (click)="exportGrades()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
          📄 Xuất CSV
        </button>
      </div>
    </div>

    <!-- Success/Error Messages -->
    <div *ngIf="saveMessage" class="mb-4 p-4 rounded-lg" [class.bg-green-50]="saveMessage.includes('thành công')" [class.border-l-4]="true" [class.border-green-500]="saveMessage.includes('thành công')" [class.bg-red-50]="saveMessage.includes('Lỗi')" [class.border-red-500]="saveMessage.includes('Lỗi')">
      <p [class.text-green-700]="saveMessage.includes('thành công')" [class.text-red-700]="saveMessage.includes('Lỗi')">{{ saveMessage }}</p>
    </div>

    <!-- Grading Table -->
    <div *ngIf="selectedClass.students.length > 0" class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">#</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mã SV</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Họ tên</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">TP1 (0-10)</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">TP2 (0-10)</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Thi CK (0-10)</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Điểm TK</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Điểm chữ</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Thao tác</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let student of selectedClass.students; let i = index" class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm font-medium text-gray-900">{{ i + 1 }}</td>
            <td class="px-4 py-3 text-sm font-medium text-gray-900">{{ student.studentCode }}</td>
            <td class="px-4 py-3 text-sm text-gray-900">{{ student.fullName }}</td>
            <td class="px-4 py-3 text-sm text-gray-600">{{ student.email }}</td>
            <td class="px-4 py-3">
              <input type="number" class="w-20 px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent" min="0" max="10" step="0.1" [(ngModel)]="student.componentScore1" placeholder="0.0" />
            </td>
            <td class="px-4 py-3">
              <input type="number" class="w-20 px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent" min="0" max="10" step="0.1" [(ngModel)]="student.componentScore2" placeholder="0.0" />
            </td>
            <td class="px-4 py-3">
              <input type="number" class="w-20 px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent" min="0" max="10" step="0.1" [(ngModel)]="student.finalExamScore" placeholder="0.0" />
            </td>
            <td class="px-4 py-3 text-sm font-semibold text-gray-900">
              <span *ngIf="student.totalScore !== null && student.totalScore !== undefined">{{ student.totalScore | number:'1.1-1' }}</span>
              <span *ngIf="student.totalScore === null || student.totalScore === undefined" class="text-gray-400">-</span>
            </td>
            <td class="px-4 py-3">
              <span *ngIf="student.grade" class="px-3 py-1 inline-flex text-sm font-semibold rounded-full bg-green-100 text-green-800">{{ student.grade }}</span>
              <span *ngIf="!student.grade" class="text-gray-400">-</span>
            </td>
            <td class="px-4 py-3">
              <button (click)="saveScores(student)" [disabled]="saving" class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors disabled:opacity-50">
                <span *ngIf="!saving">💾 Lưu</span>
                <span *ngIf="saving">⏳</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty Students State -->
    <div *ngIf="selectedClass.students.length === 0" class="text-center py-12">
      <div class="text-6xl mb-4">👥</div>
      <p class="text-gray-600 text-lg">Không có sinh viên nào trong lớp học này</p>
    </div>
  </div>
</div>